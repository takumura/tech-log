{"title":"angular-cli-ghpagesを利用する","date":"2019-11-14","category":"Angular","tag":["deploy","github pages"],"body":"\r\n\r\nAngular 7でangular-cli-ghpagesライブラリを利用して、github pagesを簡単に更新できるようなので、その設定方法などを調べました。\r\n\r\n## 実施した手順\r\n\r\nまず初めに[angular-cli-ghpagesのgithubリポジトリ](https:\/\/github.com\/angular-schule\/angular-cli-ghpages)を確認しました。\r\n\r\nPrerequisitesに`Angular project created via Angular CLI v8.3.0-next.0 or greate`と書かれているのを発見。うまくいかないかもしれないが、とりあえずAngular CLI v7系のまま設定を実施しました。\r\n\r\n```bash\r\nPS C:\\Repos\\github\\tech-log\\Website\\ClientApp> ng add angular-cli-ghpages\r\nInstalling packages for tooling via npm.\r\nnpm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.7 (node_modules\\fsevents):\r\nnpm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.7: wanted {\"os\":\"darwin\",\"arch\":\"any\"} (current: {\"os\":\"win32\",\"arch\":\"x64\"})\r\n+ angular-cli-ghpages@0.5.3\r\nadded 18 packages from 17 contributors and audited 42977 packages in 21.148s\r\nfound 607 vulnerabilities (3 moderate, 604 high)\r\n  run `npm audit fix` to fix them, or `npm audit` for details\r\nInstalled packages for tooling via npm.\r\nThe package that you are trying to add does not support schematics. You can try using a different version of the package or contact the package author to add ng-add support.\r\n```\r\n\r\n警告などが出ている（auditは今後の課題）が、今回は無視して進めます。\r\n\r\n```bash\r\nPS C:\\Repos\\github\\tech-log\\Website\\ClientApp> ng build --prod --base-href \"https:\/\/takumura.github.io\/tech-log\/\"\r\n```\r\n\r\ndry-runによる予行でどのように動くか実験。\r\n\r\n```bash\r\nPS C:\\Repos\\github\\tech-log\\Website\\ClientApp> npx angular-cli-ghpages --dry-run\r\n*** Dry-run: No changes are applied at all.\r\n*** Dry-run \/ SKIPPED: cleaning of the cache directory\r\n*** Dry-run \/ SKIPPED: copying of index.html to 404.html\r\n*** Dry-run \/ SKIPPED: publishing to \"C:\\Repos\\github\\tech-log\\Website\\ClientApp\\dist\" with the following options: { dir: 'C:\\\\Repos\\\\github\\\\tech-log\\\\Website\\\\ClientApp\\\\dist',\r\n  repo:\r\n   'undefined: current working directory (which must be a git repo in this case) will be used to commit & push',\r\n  message: 'Auto-generated commit',\r\n  branch: 'gh-pages',\r\n  user:\r\n   'undefined: local or gloabl git username & email properties will be taken',\r\n  noSilent: 'undefined: logging is in silent mode by default',\r\n  noDotfiles: 'undefined: dotfiles are included by default',\r\n  dryRun: true,\r\n  cname: 'undefined: no CNAME file will be created' }\r\n*** Successfully published!\r\n```\r\n\r\n問題なさそうなので本実行。\r\n\r\n```bash\r\nPS C:\\Repos\\github\\tech-log\\Website\\ClientApp> npx angular-cli-ghpages\r\n```\r\n\r\n初回は`Permission denied (publickey)`エラーが発生してpushに失敗。[Git: githubへのssh接続をSourceTreeからwindows 10標準のssh clientに切り替える](doc\/env\/git-ssh-configuration)<!--rehype:class=internal-link-->の対応を実施してから再チャレンジ。\r\n\r\n```bash\r\nPS C:\\Repos\\github\\tech-log\\Website\\ClientApp> npx angular-cli-ghpages\r\n*** Successfully published!\r\n```\r\n\r\n無事成功。<https:\/\/takumura.github.io\/tech-log\/> にアクセスすると、見事にサイトが表示されていました。fetchでのjsonデータ取得や、ページ遷移なども問題なく動作しています。素晴らしい！\r\n\r\n## パブリッシュスクリプトの作成\r\n\r\nprodオプション付きのビルドを実行し、生成されたdistフォルダ以下をorigin\/gh-pagesにpushするスクリプトを作成しました。\r\n\r\n**publish-to-ghpages.ps1**\r\n\r\n```bash\r\nng build --prod --base-href \"https:\/\/takumura.github.io\/tech-log\/\"\r\nnpx angular-cli-ghpages\r\n```\r\n\r\n## 作業時に参照した情報\r\n\r\n- [Deploying an Angular App to Github Pages](https:\/\/alligator.io\/angular\/deploying-angular-app-github-pages\/)\r\n- [Angular-CLIで作成したアプリをGithub Pagesにデプロイする](https:\/\/prokatsu.com\/angular-cli_github-pages_deploy\/)\r\n- [AngularのプロジェクトをGithub Pagesに公開する](https:\/\/choco14t.hatenablog.com\/entry\/2018\/07\/07\/144504)\r\n"}