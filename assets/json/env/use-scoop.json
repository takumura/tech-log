{"title":"scoopでWindowsアプリを管理する","date":"2019-11-01","category":"環境設定","tag":["tool","scoop"],"body":"\r\n\r\nscoopを利用して、開発環境の自動セットアップ、および最新版への定期的なアップデートなどの管理を上手に行えるのか試してみます。\r\n\r\n## インストール\r\n\r\nまず初めに[公式サイト]](<https://scoop.sh/>)と[GitHubリポジトリ](https://github.com/lukesampson/scoop)を確認しました。インストールはPowerShellスクリプトで行うと書いてあるので、その通りに実行しました。\r\n\r\n```ps\r\n> Invoke-Expression (New-Object System.Net.WebClient).DownloadString('https://get.scoop.sh')\r\nInitializing...\r\nDownloading scoop...\r\nExtracting...\r\nCreating shim...\r\nDownloading main bucket...\r\nExtracting...\r\nAdding ~\\scoop\\shims to your path.\r\n'lastupdate' has been set to '2019-11-01T17:22:42.8161465+09:00'\r\nScoop was installed successfully!\r\nType 'scoop help' for instructions.\r\n```\r\n\r\nログインしているアカウントのユーザフォルダ以下に`scoop`フォルダが作成されました。scoopで管理されるAppはこのフォルダ以下に配置されるようです。\r\n\r\n## Bucketの設定\r\n\r\nデフォルトではmain backetが利用可能です。`bucket add`コマンドにより、bucketを追加することができます。追加可能なbucketは`scoop\\apps\\scoop\\current\\buckets.json`で設定されており、`bucket known`コマンドで見る事もできます。\r\n\r\n```ps\r\n> scoop bucket known\r\nmain\r\nextras\r\nnightlies\r\nnirsoft\r\nphp\r\nnerd-fonts\r\nnonportable\r\njava\r\ngames\r\njetbrains\r\n```\r\n\r\n以前から利用しているAppがextrasにありそうだったので、追加しました。\r\n\r\n```ps\r\n> scoop bucket add extras\r\nChecking repo... ok\r\nThe extras bucket was added successfully.\r\n```\r\n\r\ngitがインストールされていないとbucketの追加に失敗します。その場合はgitを先にインストールします。\r\n\r\n```ps\r\nscoop install git\r\n```\r\n\r\n## よく使うであろうコマンド\r\n\r\n### scoop search\r\n\r\n指定したAppがBucket(collections of apps)にあるか検索する。\r\n\r\n```ps\r\n> scoop search nodejs\r\n'main' bucket:\r\n    nodejs-lts (12.13.0)\r\n    nodejs (13.1.0)\r\n\r\n> scoop search keepass\r\n'extras' bucket:\r\n    keepass-plugin-keeagent (0.10.1)\r\n    keepass-plugin-keeanywhere (1.5.1)\r\n    keepass-plugin-keepassnatmsg (2.0.6)\r\n    keepass-plugin-keepassrpc (1.9.0)\r\n    keepass-plugin-keetraytotp (0.99-Beta)\r\n    keepass-plugin-sequencer (0.1.1)\r\n    keepass-plugin-yafd (1.2.2.0)\r\n    keepass (2.43)\r\n    keepassxc (2.5.0)\r\n```\r\n\r\n### scoop install\r\n\r\n指定したAppをインストールする。\r\n\r\n```ps\r\n> scoop install 7zip\r\nUpdating Scoop...\r\nUpdating 'main' bucket...\r\nChecking repo... ok\r\nThe main bucket was added successfully.\r\nScoop was updated successfully!\r\nInstalling '7zip' (19.00) [64bit]\r\n7z1900-x64.msi (1.7 MB) [===============================================================================================] 100%\r\nChecking hash of 7z1900-x64.msi ... ok.\r\nExtracting 7z1900-x64.msi ... done.\r\nLinking ~\\scoop\\apps\\7zip\\current => ~\\scoop\\apps\\7zip\\19.00\r\nCreating shim for '7z'.\r\nCreating shortcut for 7-Zip (7zFM.exe)\r\n'7zip' (19.00) was installed successfully!\r\n```\r\n\r\n## scoop update\r\n\r\n`scoop udpate`コマンドでscoop自体とインストール可能なAppの情報（app manifest）を更新できます。セミコロンで続けて`scoop update *`とすることで、インストール済みのすべてのAppに対して、バージョンアップのチェックおよびAppの更新ができます。\r\n\r\n```ps\r\n> scoop update; scoop update *\r\nUpdating Scoop...\r\nUpdating 'extras' bucket...\r\n * 4366eadd vscodium: Update to version 1.40.0                           2 hours ago\r\n * 3ade6589 vscodium-portable: Update to version 1.40.0                  2 hours ago\r\n * 88e85c64 vivaldi: Update to version 2.9.1705.41                       2 hours ago\r\nUpdating 'main' bucket...\r\n * 124c0c6a ffmpeg-nightly: Update to version 20191108-e700038           2 hours ago\r\n * 20998cde annie: Update to version 0.9.6                               2 hours ago\r\n * 41fcafae terraform-provider-ibm: Update to version 0.19.0             3 hours ago\r\n * 94629c47 jx: Update to version 2.0.971                                3 hours ago\r\n * b017d181 faas-cli: Update to version 0.10.3                           3 hours ago\r\nScoop was updated successfully!\r\nLatest versions for all apps are installed! For more information try 'scoop status'\r\n```\r\n\r\n## アンインストール\r\n\r\n追加でインストールするAppは`C:\\Apps`以下にまとめるルールにしていたので、scoopをインストールし直すことにします。\r\n\r\n```ps\r\n> scoop uninstall scoop\r\nWARN  This will uninstall Scoop and all the programs that have been installed with Scoop!\r\nAre you sure? (yN): y\r\nUninstalling '7zip'\r\nRemoving shim for '7z'.\r\nWARN  Couldn't remove ~\\scoop\\apps\\7zip: 項目 C:\\Users\\takum\\scoop\\apps\\7zip\\19.00\\7-zip.dll を削除できません: パス '7-zip.dll' へのアクセスが拒否されました。.Exception\r\nUninstalling 'winmerge'\r\nRemoving shim for 'WinMergeU'.\r\nCouldn't remove ~\\scoop\\apps: 項目 C:\\Users\\takum\\scoop\\apps\\7zip\\19.00\\7-zip.dll を削除できません: パス '7-zip.dll'\r\nへのアクセスが拒否されました。\r\n```\r\n\r\n7zipインストール後にエクスプローラ統合の設定をしたために`7-zip.dll`が削除できなくなっていました。設定を解除して再起動後、アンインストールをやり直します。\r\n\r\n```ps\r\nscoop uninstall scoop\r\nWARN  This will uninstall Scoop and all the programs that have been installed with Scoop!\r\nAre you sure? (yN): y\r\nUninstalling '7zip'\r\nWARN  Shim for '7z' is missing. Skipping.\r\nRemoving ~\\scoop\\shims from your path.\r\nScoop has been uninstalled.\r\n```\r\n\r\n今度は正常にアンインストール処理が完走しました。\r\n\r\n## カスタムディレクトリにscoopをインストール\r\n\r\n公式wikiの[Installing Scoop to Custom Directory](https://github.com/lukesampson/scoop/wiki/Quick-Start#installing-scoop-to-custom-directory)を参考にして、`C:\\Apps\\scoop`以下にscoopをインストールします。\r\n\r\n```ps\r\n$env:SCOOP='C:\\Apps\\scoop'\r\n[environment]::setEnvironmentVariable('SCOOP',$env:SCOOP,'User')\r\nInvoke-Expression (New-Object System.Net.WebClient).DownloadString('https://get.scoop.sh')\r\n```\r\n\r\n## App Manifestについて\r\n\r\n公式が提供していないApp Manifestは自分で作ることも可能です。詳細な方法は[Creating an app manifest](https://github.com/lukesampson/scoop/wiki/Creating-an-app-manifest)に書かれています。\r\n\r\n## 関連項目\r\n\r\n[scoop wiki - GitHub](https://github.com/lukesampson/scoop/wiki)\r\n"}