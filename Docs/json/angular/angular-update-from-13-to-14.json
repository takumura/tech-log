{"title":"Angular v13からv14へのアップデート","date":"2022-08-11","category":"Angular","tag":["angular","angular material","ngrx","version up"],"body":"\r\n\r\nAngular routerがv14からtitle propertyを持つようになり、NGRXでもgetTitle selectorで簡単にタイトルをゲットできるようになるようです。これをモチベーションにangular 13から14へのアップグレードを実施しました。\r\n\r\n## v13 to v14のアップデート手順\r\n\r\n[Angular Update Guide](https:\/\/update.angular.io\/?l=3&v=13.0-14.0)を参考に作業を実施。\r\n\r\n### Angular関連ライブラリのアップデート\r\n\r\n``` powershell\r\n> yarn run ng update @angular\/core@14 @angular\/cli@14\r\n\r\nyarn run v1.22.18\r\n$ ng update @angular\/core@14 @angular\/cli@14\r\nThe installed Angular CLI version is outdated.\r\nInstalling a temporary Angular CLI versioned 14.1.2 to perform the update.\r\n✔ Package successfully installed.\r\nUsing package manager: yarn\r\nCollecting installed dependencies...\r\nFound 51 dependencies.\r\nFetching dependency metadata from registry...\r\n                  Package \"@angular-eslint\/schematics\" has an incompatible peer dependency to \"@angular\/cli\" (requires \">= 13.0.0 < 14.0.0\", would install \"14.1.2\").\r\n× Migration failed: Incompatible peer dependencies found.\r\nPeer dependency warnings when installing dependencies means that those dependencies might not work correctly together.\r\nYou can use the '--force' option to ignore incompatible peer dependencies and instead address these warnings later.\r\n  See \"C:\\Users\\METALA~1\\AppData\\Local\\Temp\\ng-WtdDcB\\angular-errors.log\" for further details.\r\n\r\nerror Command failed with exit code 1.\r\n```\r\n\r\nエラーメッセージを見る感じ`@angular-eslint\/schematics`も一緒にupdateしたほうが良さそうです。\r\n\r\n``` powershell\r\n>  yarn run ng update @angular\/core@14 @angular\/cli@14 @angular-eslint\/schematics@14\r\n\r\nyarn run v1.22.18\r\n$ ng update @angular\/core@14 @angular\/cli@14 @angular-eslint\/schematics@14\r\nThe installed Angular CLI version is outdated.\r\nInstalling a temporary Angular CLI versioned 14.1.2 to perform the update.\r\n✔ Package successfully installed.\r\nUsing package manager: yarn\r\nCollecting installed dependencies...\r\nFound 51 dependencies.\r\nFetching dependency metadata from registry...\r\n    Updating package.json with dependency @angular-devkit\/build-angular @ \"14.1.2\" (was \"13.1.2\")...\r\n    Updating package.json with dependency @angular-eslint\/builder @ \"14.0.2\" (was \"13.0.1\")...\r\n    Updating package.json with dependency @angular-eslint\/eslint-plugin @ \"14.0.2\" (was \"13.0.1\")...\r\n    Updating package.json with dependency @angular-eslint\/eslint-plugin-template @ \"14.0.2\" (was \"13.0.1\")...\r\n    Updating package.json with dependency @angular-eslint\/schematics @ \"14.0.2\" (was \"13.0.1\")...\r\n    Updating package.json with dependency @angular-eslint\/template-parser @ \"14.0.2\" (was \"13.0.1\")...\r\n    Updating package.json with dependency @angular\/cli @ \"14.1.2\" (was \"13.1.2\")...\r\n    Updating package.json with dependency @angular\/compiler-cli @ \"14.1.2\" (was \"13.1.1\")...\r\n    Updating package.json with dependency typescript @ \"4.7.4\" (was \"4.5.4\")...\r\n    Updating package.json with dependency @angular\/animations @ \"14.1.2\" (was \"13.1.1\")...\r\n    Updating package.json with dependency @angular\/common @ \"14.1.2\" (was \"13.1.1\")...\r\n    Updating package.json with dependency @angular\/compiler @ \"14.1.2\" (was \"13.1.1\")...\r\n    Updating package.json with dependency @angular\/core @ \"14.1.2\" (was \"13.1.1\")...\r\n    Updating package.json with dependency @angular\/forms @ \"14.1.2\" (was \"13.1.1\")...\r\n    Updating package.json with dependency @angular\/platform-browser @ \"14.1.2\" (was \"13.1.1\")...\r\n    Updating package.json with dependency @angular\/platform-browser-dynamic @ \"14.1.2\" (was \"13.1.1\")...\r\n    Updating package.json with dependency @angular\/router @ \"14.1.2\" (was \"13.1.1\")...\r\nUPDATE package.json (2301 bytes)\r\n✔ Packages successfully installed.\r\n** Executing migrations of package '@angular-eslint\/schematics' **\r\n\r\n> Updates @angular-eslint to v14.\r\nUPDATE package.json (2307 bytes)\r\nUPDATE angular.json (4143 bytes)\r\n✔ Packages installed successfully.\r\n  Migration completed.\r\n\r\n** Executing migrations of package '@angular\/cli' **\r\n\r\n> Remove 'defaultProject' option from workspace configuration.\r\n  The project to use will be determined from the current working directory.\r\nUPDATE angular.json (4095 bytes)\r\n  Migration completed.\r\n\r\n> Remove 'showCircularDependencies' option from browser and server builders.\r\n  Migration completed.\r\n\r\n> Replace 'defaultCollection' option in workspace configuration with 'schematicCollections'.\r\nUPDATE angular.json (4112 bytes)\r\n  Migration completed.\r\n\r\nUPDATE tsconfig.json (936 bytes)  Migration completed.\r\n\r\n** Executing migrations of package '@angular\/core' **\r\n\r\n> As of Angular version 13, `entryComponents` are no longer necessary.\r\n  Migration completed.\r\n\r\n> In Angular version 14, the `pathMatch` property of `Routes` was updated to be a strict union of the two valid options: `'full'|'prefix'`.\r\n  `Routes` and `Route` variables need an explicit type so TypeScript does not infer the property as the looser `string`.\r\n  Migration completed.\r\n\r\n> As of Angular version 14, Forms model classes accept a type parameter, and existing usages must be opted out to preserve backwards-compatibility.\r\n  Migration completed.\r\n\r\nDone in 156.21s.\r\n```\r\n\r\n正常終了しました。\r\n\r\n### Angular Material関連ライブラリのアップデート\r\n\r\n続けてangular materialのアップグレードを行おうとしたところ、先の変更をcommitしてからじゃないとダメ！と怒られてしまいました。\r\n\r\n``` powershell\r\n> yarn run ng update @angular\/material@14\r\n\r\nyarn run v1.22.18\r\n$ ng update @angular\/material@14\r\nError: Repository is not clean. Please commit or stash any changes before updating.\r\nerror Command failed with exit code 1.\r\n```\r\n\r\nコミット後に再実施します。\r\n\r\n``` powershell\r\n> yarn run ng update @angular\/material@14\r\n\r\nyarn run v1.22.18\r\n$ ng update @angular\/material@14\r\nUsing package manager: yarn\r\nCollecting installed dependencies...\r\nFound 51 dependencies.\r\nFetching dependency metadata from registry...\r\n    Updating package.json with dependency @angular\/cdk @ \"14.1.1\" (was \"13.1.3\")...\r\n    Updating package.json with dependency @angular\/material @ \"14.1.1\" (was \"13.1.3\")...\r\nUPDATE package.json (2306 bytes)\r\n✔ Packages successfully installed.\r\n** Executing migrations of package '@angular\/cdk' **\r\n\r\n> Updates the Angular CDK to v14.\r\n\r\n      ✓  Updated Angular CDK to version 14\r\n\r\n  Migration completed.\r\n\r\n** Executing migrations of package '@angular\/material' **\r\n\r\n> Updates the Angular Material to v14.\r\n\r\n      ✓  Updated Angular Material to version 14\r\n\r\n  Migration completed.\r\n\r\nDone in 38.79s.\r\n```\r\n\r\nBasicの手順は以上で終了です。この時点でのpackage.jsonをチェックします。\r\n\r\n``` json\r\n{\r\n  \"name\": \"net6-markdown-web-engine\",\r\n  \"version\": \"0.0.0\",\r\n  \"scripts\": {\r\n    \"ng\": \"ng\",\r\n    \"start\": \"ng serve --ssl --ssl-cert %APPDATA%\\\\ASP.NET\\\\https\\\\%npm_package_name%.pem --ssl-key %APPDATA%\\\\ASP.NET\\\\https\\\\%npm_package_name%.key\",\r\n    \"build\": \"ng build\",\r\n    \"watch\": \"ng build --watch --configuration development\",\r\n    \"test\": \"ng test\",\r\n    \"prestart\": \"node aspnetcore-https\",\r\n    \"lint\": \"ng lint\"\r\n  },\r\n  \"private\": true,\r\n  \"dependencies\": {\r\n    \"@angular\/animations\": \"^14.1.2\",\r\n    \"@angular\/cdk\": \"14.1.1\",\r\n    \"@angular\/common\": \"^14.1.2\",\r\n    \"@angular\/compiler\": \"^14.1.2\",\r\n    \"@angular\/core\": \"^14.1.2\",\r\n    \"@angular\/forms\": \"^14.1.2\",\r\n    \"@angular\/material\": \"14.1.1\",\r\n    \"@angular\/platform-browser\": \"^14.1.2\",\r\n    \"@angular\/platform-browser-dynamic\": \"^14.1.2\",\r\n    \"@angular\/router\": \"^14.1.2\",\r\n    \"@mdi\/angular-material\": \"^7.0.96\",\r\n    \"@ngrx\/effects\": \"^13.2.0\",\r\n    \"@ngrx\/router-store\": \"^13.2.0\",\r\n    \"@ngrx\/store\": \"^13.0.2\",\r\n    \"@ngrx\/store-devtools\": \"^13.2.0\",\r\n    \"jest-editor-support\": \"*\",\r\n    \"rehype-attr\": \"^2.0.8\",\r\n    \"rehype-autolink-headings\": \"^6.1.1\",\r\n    \"rehype-external-links\": \"^1.0.1\",\r\n    \"rehype-prism-plus\": \"^1.4.2\",\r\n    \"rehype-raw\": \"^6.1.1\",\r\n    \"rehype-slug\": \"^5.0.1\",\r\n    \"rehype-stringify\": \"^9.0.3\",\r\n    \"remark-parse\": \"^10.0.1\",\r\n    \"remark-rehype\": \"^10.1.0\",\r\n    \"rxjs\": \"~7.4.0\",\r\n    \"tslib\": \"^2.3.0\",\r\n    \"unified\": \"^10.1.2\",\r\n    \"zone.js\": \"~0.11.4\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@angular-devkit\/build-angular\": \"^14.1.2\",\r\n    \"@angular-eslint\/builder\": \"14.0.2\",\r\n    \"@angular-eslint\/eslint-plugin\": \"14.0.2\",\r\n    \"@angular-eslint\/eslint-plugin-template\": \"14.0.2\",\r\n    \"@angular-eslint\/schematics\": \"14.0.2\",\r\n    \"@angular-eslint\/template-parser\": \"14.0.2\",\r\n    \"@angular\/cli\": \"^14.1.2\",\r\n    \"@angular\/compiler-cli\": \"^14.1.2\",\r\n    \"@ngrx\/schematics\": \"^14.0.2\",\r\n    \"@types\/jasmine\": \"~3.10.0\",\r\n    \"@types\/node\": \"^12.11.1\",\r\n    \"@typescript-eslint\/eslint-plugin\": \"^5.29.0\",\r\n    \"@typescript-eslint\/parser\": \"^5.29.0\",\r\n    \"eslint\": \"^8.18.0\",\r\n    \"eslint-plugin-ngrx\": \"^2.0.0\",\r\n    \"jasmine-core\": \"~3.10.0\",\r\n    \"karma\": \"~6.3.0\",\r\n    \"karma-chrome-launcher\": \"~3.1.0\",\r\n    \"karma-coverage\": \"~2.1.0\",\r\n    \"karma-jasmine\": \"~4.0.0\",\r\n    \"karma-jasmine-html-reporter\": \"~1.7.0\",\r\n    \"typescript\": \"~4.7.4\"\r\n  }\r\n}\r\n```\r\n\r\n### NGRX関連ライブラリのアップデート\r\n\r\nNGRX系がv13なので、これもupdateします。\r\n\r\n``` powershell\r\n> yarn run ng update @ngrx\/store@14\r\n\r\nyarn run v1.22.18\r\n$ ng update @ngrx\/store@14\r\nUsing package manager: yarn\r\nCollecting installed dependencies...\r\nFound 51 dependencies.\r\nFetching dependency metadata from registry...\r\n    Updating package.json with dependency @ngrx\/schematics @ \"14.1.0\" (was \"14.0.2\")...\r\n    Updating package.json with dependency @ngrx\/effects @ \"14.1.0\" (was \"13.2.0\")...\r\n    Updating package.json with dependency @ngrx\/router-store @ \"14.1.0\" (was \"13.2.0\")...\r\n    Updating package.json with dependency @ngrx\/store @ \"14.1.0\" (was \"13.0.2\")...\r\n    Updating package.json with dependency @ngrx\/store-devtools @ \"14.1.0\" (was \"13.2.0\")...\r\n    Updating package.json with dependency rxjs @ \"7.5.6\" (was \"7.4.0\")...\r\nUPDATE package.json (2306 bytes)\r\n✔ Packages successfully installed.\r\n** Executing migrations of package '@ngrx\/router-store' **\r\n\r\n> The road to v14.\r\n  Migration completed.\r\n\r\nDone in 35.67s.\r\n```\r\n\r\n## 関連項目\r\n\r\n- [Angular v14 is now available!](https:\/\/blog.angular.io\/angular-v14-is-now-available-391a6db736af)\r\n- [router.selectors.ts - NGRX](https:\/\/github.com\/santoshyadavdev\/platform\/blob\/master\/projects\/ngrx.io\/content\/examples\/router-store-selectors\/src\/app\/router.selectors.ts)\r\n"}