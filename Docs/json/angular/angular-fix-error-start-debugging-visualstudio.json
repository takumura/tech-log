{"title":"新しいAngularテンプレートのVisualStudioデバッグエラー: デバッグアダプターを起動できませんでした","date":"2022-09-23","category":"Angular","tag":["Visual Studio","angular","esproj"],"body":"\r\n\r\n[ASP.NET Coreの新しいAngular template](https:\/\/learn.microsoft.com\/ja-jp\/visualstudio\/javascript\/tutorial-asp-net-core-with-angular?view=vs-2022)を使って作成したプロジェクトを試しています。\r\n\r\n今回、Visual Studio 2022で新規にプロジェクトを作成後に、Angularのフロントエンドプロジェクト名を変更したところ、デバッグ実行時に「デバッグアダプターを起動できませんでした」というエラーが発生するようになってしまいました。原因と解消法について調査します。\r\n\r\n<img src=\"assets\/images\/angular-fix-error-start-debugging-visualstudio\/angular-fix-error-start-debugging-visualstudio-1.png\" alt=\"debug error\" title=\"debug error\">\r\n\r\n## 原因\r\n\r\n「デバッグアダプターを起動できませんでした」は、デバッグ開始時にアタッチするブラウザを見つけられない場合に発生するエラーのようです。\r\n\r\n新テンプレートでは、デバッグ開始時にMultiple Startupプロジェクトという形で、ASP.NET CoreのバックエンドプロジェクトとAngularのフロントエンドプロジェクトを同時に指定します。ASP.NET Coreのプロジェクト単体では、デバッグ実行が正常に動作するので、Angularのプロジェクト(esproj形式)の方に問題がありそうです。\r\n\r\nプロジェクト名を変えたことがきっかけでエラーが始まったので、何か古いキャッシュが影響しているのかと再起動やtempデータ削除、プロジェクトの完全rebuildなどを試してみましたが効果がありません。\r\n\r\nほぼ変更前と同じ別プロジェクトが残っており、そちらではデバッグ実行が正常に行えたので比較を行い、プロジェクトのパーソナル設定ファイル`*.esproj.user`に差異を見つけました。\r\n\r\n``` diff\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<Project ToolsVersion=\"Current\" xmlns=\"http:\/\/schemas.microsoft.com\/developer\/msbuild\/2003\">\r\n  <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|AnyCPU'\">\r\n+    <DebuggerFlavor>LaunchJsonDebugger<\/DebuggerFlavor>\r\n+    <LaunchJsonTarget>\r\n+      {\r\n+      \"type\": \"pwa-msedge\",\r\n+      \"request\": \"launch\",\r\n+      \"name\": \"localhost (Edge)\",\r\n+      \"url\": \"https:\/\/localhost:4200\",\r\n+      \"webRoot\": \"C:\\\\Repos\\\\tech-log\\\\AngularStandalone\"\r\n+      }\r\n+    <\/LaunchJsonTarget>\r\n  <\/PropertyGroup>\r\n<\/Project>\r\n```\r\n\r\nパーソナル設定ファイルの中に`<DebugFlavor>`と`launch.json`に出てくるようなブラウザ接続の設定が記載されていました。これらの設定を追加したところデバッグのエラーも解消しました。\r\n\r\n`webRoot`の値が、各開発者のローカルパスになるため`.user`ファイルでの記述になるのはわかるのですが、`.gitignore`では`.user`ファイルは除外指定にしているので、repositoryからクローンした開発者環境ではVisual Studioのデバッグに問題がありそうです。\r\n\r\n## 暫定対応\r\n\r\n試行錯誤してみたところ、`webRoot`の指定がなくても`LaunchJsonTarget`の指定があればdebugエラーが解消するので、ローカルパスを抜いた記述を`esproj`のほうにおまじない的に書いておいて様子を見ようと思います。\r\n"}